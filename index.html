        .clickable-row {
            cursor: pointer;
            transition: all 0.3s ease;
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            background: rgba(20, 25, 40, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
        }

        /* Main Content Styles */
        main {
            padding: 2rem 0;
        }

        .page-title {
            background: rgba(20, 25, 40, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .page-title h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .page-title p {
            color: #a0a0a0;
        }

        /* Content Cards */
        .content-card {
            background: rgba(20, 25, 40, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 35, 50, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #e8e8e8;
        }

        th {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #ffd700;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .clickable-row:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateX(2px);
        }

        /* Map Styles */
        .map-container {
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            margin-top: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #map {
            height: 100%;
            width: 100%;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            color: #a0a0a0;
        }

        .error {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b7a;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .container {
                padding: 10px;
            }

            .page-title h1 {
                font-size: 2rem;
            }

            .map-container {
                height: 300px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 0.5rem;
            }
        }

        /* Hidden class for page switching */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">üè¢ HVAC Management</div>
        </div>
    </header>

    <div class="container">
        <!-- COMPANIES PAGE -->
        <div id="companiesPage">
            <div class="page-title">
                <h1>Companies</h1>
                <p>Select a company to view their stores</p>
            </div>
            
            <div class="content-card">
                <div id="companiesLoading" class="loading">Loading companies...</div>
                <div id="companiesError" class="error hidden"></div>
                
                <div id="companiesContent" class="hidden">
                    <div class="table-container">
                        <table id="companiesTable">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>Address</th>
                                    <th>Contact</th>
                                    <th>Stores Count</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <div class="map-container">
                        <div id="companiesMap"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STORES PAGE -->
        <div id="storesPage" class="hidden">
            <div class="page-title">
                <h1 id="storesTitle">Stores</h1>
                <p>Select a store to view equipment</p>
                <button id="backToCompanies" class="btn" style="margin-top: 1rem;">‚Üê Back to Companies</button>
            </div>
            
            <div class="content-card">
                <div id="storesLoading" class="loading">Loading stores...</div>
                <div id="storesError" class="error hidden"></div>
                
                <div id="storesContent" class="hidden">
                    <div class="table-container">
                        <table id="storesTable">
                            <thead>
                                <tr>
                                    <th>Store Name</th>
                                    <th>Address</th>
                                    <th>Manager</th>
                                    <th>Equipment Count</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <div class="map-container">
                        <div id="storesMap"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- EQUIPMENT PAGE -->
        <div id="equipmentPage" class="hidden">
            <div class="page-title">
                <h1 id="equipmentTitle">Equipment</h1>
                <p>HVAC equipment for this location</p>
                <button id="backToStores" class="btn" style="margin-top: 1rem;">‚Üê Back to Stores</button>
            </div>
            
            <div class="content-card">
                <div id="equipmentLoading" class="loading">Loading equipment...</div>
                <div id="equipmentError" class="error hidden"></div>
                
                <div id="equipmentContent" class="hidden">
                    <div class="table-container">
                        <table id="equipmentTable">
                            <thead>
                                <tr>
                                    <th>Equipment ID</th>
                                    <th>Type</th>
                                    <th>Brand</th>
                                    <th>Model</th>
                                    <th>Install Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    
    <script>
        // ============================================================================
        // CONFIGURATION
        // ============================================================================
        
        const CONFIG = {
            // Default map center (you can change this to your company HQ)
            DEFAULT_MAP_CENTER: [40.7128, -74.0060], // New York City
            DEFAULT_MAP_ZOOM: 10
        };

        // ============================================================================
        // GLOBAL STATE
        // ============================================================================
        
        let currentPage = 'companies';
        let currentCompanyId = null;
        let currentStoreId = null;
        let companiesMap = null;
        let storesMap = null;
        
        // Mock data for demonstration
        const mockData = {
            companies: [
                {
                    id: 1,
                    name: 'HVAC Solutions Inc.',
                    address: '123 Main St, New York, NY',
                    contact: 'john@hvacsolutions.com',
                    storesCount: 5,
                    lat: 40.7589,
                    lng: -73.9851
                },
                {
                    id: 2,
                    name: 'Climate Control Corp',
                    address: '456 Oak Ave, Brooklyn, NY',
                    contact: 'sarah@climatecontrol.com',
                    storesCount: 3,
                    lat: 40.6782,
                    lng: -73.9442
                },
                {
                    id: 3,
                    name: 'Air Tech Services',
                    address: '789 Pine Rd, Queens, NY',
                    contact: 'mike@airtech.com',
                    storesCount: 8,
                    lat: 40.7282,
                    lng: -73.7949
                }
            ],
            stores: [
                // Company 1 stores
                {
                    id: 1,
                    companyId: 1,
                    name: 'Manhattan Branch',
                    address: '100 Broadway, New York, NY',
                    manager: 'Alice Johnson',
                    equipmentCount: 12,
                    lat: 40.7074,
                    lng: -74.0113
                },
                {
                    id: 2,
                    companyId: 1,
                    name: 'Uptown Location',
                    address: '200 W 125th St, New York, NY',
                    manager: 'Bob Smith',
                    equipmentCount: 8,
                    lat: 40.8176,
                    lng: -73.9482
                },
                // Company 2 stores
                {
                    id: 3,
                    companyId: 2,
                    name: 'Brooklyn Central',
                    address: '300 Atlantic Ave, Brooklyn, NY',
                    manager: 'Carol Davis',
                    equipmentCount: 15,
                    lat: 40.6892,
                    lng: -73.9442
                },
                // Company 3 stores
                {
                    id: 4,
                    companyId: 3,
                    name: 'Queens Plaza',
                    address: '400 Northern Blvd, Queens, NY',
                    manager: 'David Wilson',
                    equipmentCount: 20,
                    lat: 40.7505,
                    lng: -73.9425
                }
            ],
            equipment: [
                // Store 1 equipment
                {
                    id: 'HVAC-001',
                    storeId: 1,
                    type: 'Air Conditioner',
                    brand: 'Carrier',
                    model: 'XCV-2000',
                    installDate: '2022-03-15',
                    status: 'Active'
                },
                {
                    id: 'HVAC-002',
                    storeId: 1,
                    type: 'Furnace',
                    brand: 'Trane',
                    model: 'TUH1B080A9421A',
                    installDate: '2021-11-08',
                    status: 'Active'
                },
                {
                    id: 'HVAC-003',
                    storeId: 1,
                    type: 'Heat Pump',
                    brand: 'Rheem',
                    model: 'RP1448BJ1NA',
                    installDate: '2023-01-20',
                    status: 'Maintenance'
                },
                // Store 2 equipment
                {
                    id: 'HVAC-004',
                    storeId: 2,
                    type: 'Air Conditioner',
                    brand: 'Lennox',
                    model: 'XC25-024-230',
                    installDate: '2022-07-12',
                    status: 'Active'
                },
                {
                    id: 'HVAC-005',
                    storeId: 2,
                    type: 'Ventilation System',
                    brand: 'Honeywell',
                    model: 'VNT-3000',
                    installDate: '2021-09-30',
                    status: 'Active'
                }
            ]
        };

        // ============================================================================
        // API FUNCTIONS
        // ============================================================================
        
        async function fetchFromAPI(endpoint) {
            try {
                // In a real implementation, you would make actual API calls here
                // For demonstration, we'll use mock data with a delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                switch (endpoint) {
                    case 'companies':
                        return mockData.companies;
                    case 'stores':
                        return mockData.stores.filter(store => 
                            currentCompanyId ? store.companyId === parseInt(currentCompanyId) : true
                        );
                    case 'equipment':
                        return mockData.equipment.filter(equipment => 
                            currentStoreId ? equipment.storeId === parseInt(currentStoreId) : true
                        );
                    default:
                        throw new Error('Unknown endpoint');
                }
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // ============================================================================
        // UI HELPER FUNCTIONS
        // ============================================================================
        
        function showPage(pageId) {
            // Hide all pages
            const pages = ['companiesPage', 'storesPage', 'equipmentPage'];
            pages.forEach(id => hideElement(id));
            
            // Show the requested page
            showElement(pageId);
            currentPage = pageId.replace('Page', '');
        }

        function showElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        function hideElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('hidden');
            }
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }
        }

        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.classList.add('hidden');
            }
        }

        // ============================================================================
        // MAP FUNCTIONS
        // ============================================================================
        
        function initializeMap(containerId, items, onMarkerClick) {
            // Destroy existing map if it exists
            if (containerId === 'companiesMap' && companiesMap) {
                companiesMap.remove();
            }
            if (containerId === 'storesMap' && storesMap) {
                storesMap.remove();
            }
            
            const map = L.map(containerId).setView(CONFIG.DEFAULT_MAP_CENTER, CONFIG.DEFAULT_MAP_ZOOM);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add markers for each item
            const markers = [];
            items.forEach(item => {
                if (item.lat && item.lng) {
                    const marker = L.marker([item.lat, item.lng]).addTo(map);
                    
                    const popupContent = `
                        <div style="text-align: center;">
                            <strong>${item.name}</strong><br>
                            <small>${item.address}</small><br>
                            <button onclick="${onMarkerClick}(${item.id})" 
                                    style="margin-top: 8px; padding: 4px 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                View Details
                            </button>
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                    markers.push(marker);
                }
            });
            
            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            // Store map reference
            if (containerId === 'companiesMap') {
                companiesMap = map;
            } else if (containerId === 'storesMap') {
                storesMap = map;
            }
            
            return map;
        }

        // ============================================================================
        // COMPANIES PAGE FUNCTIONS
        // ============================================================================
        
        async function loadCompanies() {
            showPage('companiesPage');
            showElement('companiesLoading');
            hideElement('companiesContent');
            hideError('companiesError');
            
            try {
                const companies = await fetchFromAPI('companies');
                displayCompanies(companies);
                initializeMap('companiesMap', companies, 'selectCompany');
                
                hideElement('companiesLoading');
                showElement('companiesContent');
            } catch (error) {
                hideElement('companiesLoading');
                showError('companiesError', 'Failed to load companies. Please try again.');
            }
        }

        function displayCompanies(companies) {
            const tbody = document.querySelector('#companiesTable tbody');
            tbody.innerHTML = '';
            
            companies.forEach(company => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => selectCompany(company.id);
                
                row.innerHTML = `
                    <td><strong>${company.name}</strong></td>
                    <td>${company.address}</td>
                    <td>${company.contact}</td>
                    <td>${company.storesCount} stores</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function selectCompany(companyId) {
            currentCompanyId = companyId;
            loadStores();
        }

        // ============================================================================
        // STORES PAGE FUNCTIONS
        // ============================================================================
        
        async function loadStores() {
            showPage('storesPage');
            showElement('storesLoading');
            hideElement('storesContent');
            hideError('storesError');
            
            try {
                const stores = await fetchFromAPI('stores');
                const company = mockData.companies.find(c => c.id === parseInt(currentCompanyId));
                
                document.getElementById('storesTitle').textContent = `${company.name} - Stores`;
                
                displayStores(stores);
                initializeMap('storesMap', stores, 'selectStore');
                
                hideElement('storesLoading');
                showElement('storesContent');
            } catch (error) {
                hideElement('storesLoading');
                showError('storesError', 'Failed to load stores. Please try again.');
            }
        }

        function displayStores(stores) {
            const tbody = document.querySelector('#storesTable tbody');
            tbody.innerHTML = '';
            
            stores.forEach(store => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => selectStore(store.id);
                
                row.innerHTML = `
                    <td><strong>${store.name}</strong></td>
                    <td>${store.address}</td>
                    <td>${store.manager}</td>
                    <td>${store.equipmentCount} units</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function selectStore(storeId) {
            currentStoreId = storeId;
            loadEquipment();
        }

        // ============================================================================
        // EQUIPMENT PAGE FUNCTIONS
        // ============================================================================
        
        async function loadEquipment() {
            showPage('equipmentPage');
            showElement('equipmentLoading');
            hideElement('equipmentContent');
            hideError('equipmentError');
            
            try {
                const equipment = await fetchFromAPI('equipment');
                const store = mockData.stores.find(s => s.id === parseInt(currentStoreId));
                
                document.getElementById('equipmentTitle').textContent = `${store.name} - Equipment`;
                
                displayEquipment(equipment);
                
                hideElement('equipmentLoading');
                showElement('equipmentContent');
            } catch (error) {
                hideElement('equipmentLoading');
                showError('equipmentError', 'Failed to load equipment. Please try again.');
            }
        }

        function displayEquipment(equipment) {
            const tbody = document.querySelector('#equipmentTable tbody');
            tbody.innerHTML = '';
            
            equipment.forEach(item => {
                const row = document.createElement('tr');
                
                // Status styling
                let statusColor = '';
                switch (item.status.toLowerCase()) {
                    case 'active':
                        statusColor = '#28a745';
                        break;
                    case 'maintenance':
                        statusColor = '#ffc107';
                        break;
                    case 'inactive':
                        statusColor = '#dc3545';
                        break;
                    default:
                        statusColor = '#6c757d';
                }
                
                row.innerHTML = `
                    <td><strong>${item.id}</strong></td>
                    <td>${item.type}</td>
                    <td>${item.brand}</td>
                    <td>${item.model}</td>
                    <td>${item.installDate}</td>
                    <td><span style="color: ${statusColor}; font-weight: bold;">‚óè</span> ${item.status}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ============================================================================
        // EVENT LISTENERS AND INITIALIZATION
        // ============================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation Buttons
            document.getElementById('backToCompanies').addEventListener('click', loadCompanies);
            document.getElementById('backToStores').addEventListener('click', loadStores);
            
            // Start the app by loading companies
            loadCompanies();
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.page) {
                switch (event.state.page) {
                    case 'companies':
                        loadCompanies();
                        break;
                    case 'stores':
                        if (event.state.companyId) {
                            currentCompanyId = event.state.companyId;
                            loadStores();
                        }
                        break;
                    case 'equipment':
                        if (event.state.storeId) {
                            currentStoreId = event.state.storeId;
                            loadEquipment();
                        }
                        break;
                }
            }
        });

        // Global functions for map marker clicks (needed for popup buttons)
        window.selectCompany = selectCompany;
        window.selectStore = selectStore;
    </script>
</body>
</html>
